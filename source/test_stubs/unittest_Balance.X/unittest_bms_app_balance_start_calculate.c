/*
 *   uinttest_bms_app_balance_start_caolculate
 *
 * This unit test validates the calculations used to figure out
 * which cells need to be calculated.
 *
 * It ensures that if follows the requirements laid out for cell celection
 */

#include <string.h>
#include "bms_defs.h"

#include "../unittest_utilities.h"
#include "../unittest_bms_coreprocessing.h"

#define BMS_APP_BALANCE_GROUP_ONE_MASK       (0x1249)
#define BMS_APP_BALANCE_GROUP_TWO_MASK       (0x0492)
#define BMS_APP_BALANCE_GROUP_THREE_MASK     (0x0924)

#define BMS_APP_MAX_BALANCE_GATE_CLOSE_TIME_SECS     (0.240f)
#define BMS_APP_MAX_BALANCE_GATE_OPEN_TIME_SECS      (0.100f)
#define BMS_BALANCE_STABILZE_FUDGE_FACTOR            (0.005f)

extern CoreDataType gCoreData[ MAX_NUM_CORES ];
extern CoreDataType gCoreDataSlow[ MAX_NUM_CORES ];

extern BMSBatterySummaryType gBatterySummary;
extern BMSSystemStatusType gBatteryStatus;

extern CBITFlagsType gCBITFlags;
extern PBITFlagsType gPBITFlags;
extern WarrentyViolationsType gWarrantyViolations;

#undef PRIVATE
#define PRIVATE extern

PRIVATE int gBalanceStartCurrentThresholdTime;

PRIVATE float sBalanceVoltage[ MAX_NUM_CORES ];

PRIVATE float sBalanceTimerStartMs;                  //Start of gate on/off times
PRIVATE float sBalanceTimeSeconds;                   //Keeps track of the gate on/off times

PRIVATE uint64_t    sBalanceSessionTimerStartMs;      //Start time of the session (in miliseconds)
PRIVATE long double sBalanceSessionTimeSeconds;      //Keeps track of the total balance session time

PRIVATE unsigned int sBalanceActiveGroup;

PRIVATE unsigned int sOldChargingMode;

extern unsigned int currentValidStable;
extern unsigned int voltagesAreValid;
extern unsigned int temperaturesAreValid;

unsigned int bms_app_is_balancing();
void bms_app_balance_start_calculate();
void bms_app_balance_update_calculate();
unsigned int bms_app_are_balance_gates_off( unsigned int coreId );
unsigned int bms_app_balance_get_group_mask();
void bms_app_balance_update_times();
void bms_app_balance_start();
void bms_app_balance_stop();
void bms_app_balance_check_progress();
int bms_app_is_okay_to_balance();
void bms_app_process_balance();

/*
 *
 */
#define UT_SC_TEST_COUNT     (52)

/*
    typedef struct __CoreData
    {
        float voltages[MAX_NUM_CELLS_PER_CORE];
        float temperatures[MAX_NUM_TEMP];

        float   max_cell_voltage;
        unsigned int max_cell_id;

        float   min_cell_voltage;
        unsigned int min_cell_id;

        unsigned short gpio;
        unsigned short balance;
    } CoreDataType;
*/

typedef struct __BalanceModuleTestData
{
    float voltages[MAX_NUM_CELLS_PER_CORE][UT_SC_TEST_COUNT];
    float vcell_max[UT_SC_TEST_COUNT];
    float vcell_min[UT_SC_TEST_COUNT];
    float balance_to_voltages[UT_SC_TEST_COUNT];
    uint16_t    balance_gates_on[UT_SC_TEST_COUNT];
    uint16_t    balance_gates_off[UT_SC_TEST_COUNT];
} BalanceTestData;

const BalanceTestData testDataCellVoltages[MAX_NUM_CORES] =
{
    {
        .voltages = {{4.096f, 4.046f, 3.996f, 3.946f, 3.896f,3.906f,	3.916f,	3.926f,	3.936f,	3.946f,	3.956f,	3.966f,	3.976f,	3.986f,	3.996f,	4.006f,	4.016f,	4.026f,	4.036f,	4.046f,	4.056f,	4.066f,	4.076f,	4.086f,	4.096f,	4.106f,	4.116f,	4.126f,	4.136f,	4.146f,	4.156f,	4.166f,	4.176f,	4.186f,	4.196f,	4.206f,	4.216f,	4.226f,	4.236f,	4.246f,	4.256f,	4.266f,	4.276f,	4.286f,	4.296f,	4.306f,	4.316f,	4.326f,	4.336f,	4.346f,	4.356f,	4.366f},
                     {4.032f, 3.982f, 3.932f, 3.882f, 3.832f,3.842f,	3.852f,	3.862f,	3.872f,	3.882f,	3.892f,	3.902f,	3.912f,	3.922f,	3.932f,	3.942f,	3.952f,	3.962f,	3.972f,	3.982f,	3.992f,	4.002f,	4.012f,	4.022f,	4.032f,	4.042f,	4.052f,	4.062f,	4.072f,	4.082f,	4.092f,	4.102f,	4.112f,	4.122f,	4.132f,	4.142f,	4.152f,	4.162f,	4.172f,	4.182f,	4.192f,	4.202f,	4.212f,	4.222f,	4.232f,	4.242f,	4.252f,	4.262f,	4.272f,	4.282f,	4.292f,	4.302f},
                     {4.012f, 3.962f, 3.912f, 3.862f, 3.812f,3.822f,	3.832f,	3.842f,	3.852f,	3.862f,	3.872f,	3.882f,	3.892f,	3.902f,	3.912f,	3.922f,	3.932f,	3.942f,	3.952f,	3.962f,	3.972f,	3.982f,	3.992f,	4.002f,	4.012f,	4.022f,	4.032f,	4.042f,	4.052f,	4.062f,	4.072f,	4.082f,	4.092f,	4.102f,	4.112f,	4.122f,	4.132f,	4.142f,	4.152f,	4.162f,	4.172f,	4.182f,	4.192f,	4.202f,	4.212f,	4.222f,	4.232f,	4.242f,	4.252f,	4.262f,	4.272f,	4.282f},
                     {4.000f, 3.950f, 3.900f, 3.850f, 3.800f,3.810f,	3.820f,	3.830f,	3.840f,	3.850f,	3.860f,	3.870f,	3.880f,	3.890f,	3.900f, 3.910f,	3.920f,	3.930f,	3.940f,	3.950f,	3.960f,	3.970f,	3.980f,	3.990f,	4.000f, 4.010f,	4.020f,	4.030f,	4.040f,	4.050f,	4.060f,	4.070f,	4.080f,	4.090f,	4.100f, 4.110f,	4.120f,	4.130f,	4.140f,	4.150f,	4.160f,	4.170f,	4.180f,	4.190f,	4.200f, 4.210f,	4.220f,	4.230f,	4.240f,	4.250f,	4.260f,	4.270f},
                     {4.004f, 3.954f, 3.904f, 3.854f, 3.804f,3.814f,	3.824f,	3.834f,	3.844f,	3.854f,	3.864f,	3.874f,	3.884f,	3.894f,	3.904f,	3.914f,	3.924f,	3.934f,	3.944f,	3.954f,	3.964f,	3.974f,	3.984f,	3.994f,	4.004f,	4.014f,	4.024f,	4.034f,	4.044f,	4.054f,	4.064f,	4.074f,	4.084f,	4.094f,	4.104f,	4.114f,	4.124f,	4.134f,	4.144f,	4.154f,	4.164f,	4.174f,	4.184f,	4.194f,	4.204f,	4.214f,	4.224f,	4.234f,	4.244f,	4.254f,	4.264f,	4.274f},
                     {3.998f, 3.948f, 3.898f, 3.848f, 3.798f,3.808f,	3.818f,	3.828f,	3.838f,	3.848f,	3.858f,	3.868f,	3.878f,	3.888f,	3.898f,	3.908f,	3.918f,	3.928f,	3.938f,	3.948f,	3.958f,	3.968f,	3.978f,	3.988f,	3.998f,	4.008f,	4.018f,	4.028f,	4.038f,	4.048f,	4.058f,	4.068f,	4.078f,	4.088f,	4.098f,	4.108f,	4.118f,	4.128f,	4.138f,	4.148f,	4.158f,	4.168f,	4.178f,	4.188f,	4.198f,	4.208f,	4.218f,	4.228f,	4.238f,	4.248f,	4.258f,	4.268f},
                     {3.995f, 3.945f, 3.895f, 3.845f, 3.795f,3.805f,	3.815f,	3.825f,	3.835f,	3.845f,	3.855f,	3.865f,	3.875f,	3.885f,	3.895f,	3.905f,	3.915f,	3.925f,	3.935f,	3.945f,	3.955f,	3.965f,	3.975f,	3.985f,	3.995f,	4.005f,	4.015f,	4.025f,	4.035f,	4.045f,	4.055f,	4.065f,	4.075f,	4.085f,	4.095f,	4.105f,	4.115f,	4.125f,	4.135f,	4.145f,	4.155f,	4.165f,	4.175f,	4.185f,	4.195f,	4.205f,	4.215f,	4.225f,	4.235f,	4.245f,	4.255f,	4.265f},
                     {3.992f, 3.942f, 3.892f, 3.842f, 3.792f,3.802f,	3.812f,	3.822f,	3.832f,	3.842f,	3.852f,	3.862f,	3.872f,	3.882f,	3.892f,	3.902f,	3.912f,	3.922f,	3.932f,	3.942f,	3.952f,	3.962f,	3.972f,	3.982f,	3.992f,	4.002f,	4.012f,	4.022f,	4.032f,	4.042f,	4.052f,	4.062f,	4.072f,	4.082f,	4.092f,	4.102f,	4.112f,	4.122f,	4.132f,	4.142f,	4.152f,	4.162f,	4.172f,	4.182f,	4.192f,	4.202f,	4.212f,	4.222f,	4.232f,	4.242f,	4.252f,	4.262f},
                     {3.991f, 3.941f, 3.891f, 3.841f, 3.791f,3.801f,	3.811f,	3.821f,	3.831f,	3.841f,	3.851f,	3.861f,	3.871f,	3.881f,	3.891f,	3.901f,	3.911f,	3.921f,	3.931f,	3.941f,	3.951f,	3.961f,	3.971f,	3.981f,	3.991f,	4.001f,	4.011f,	4.021f,	4.031f,	4.041f,	4.051f,	4.061f,	4.071f,	4.081f,	4.091f,	4.101f,	4.111f,	4.121f,	4.131f,	4.141f,	4.151f,	4.161f,	4.171f,	4.181f,	4.191f,	4.201f,	4.211f,	4.221f,	4.231f,	4.241f,	4.251f,	4.261f},
                     {3.996f, 3.946f, 3.896f, 3.846f, 3.796f,3.806f,	3.816f,	3.826f,	3.836f,	3.846f,	3.856f,	3.866f,	3.876f,	3.886f,	3.896f,	3.906f,	3.916f,	3.926f,	3.936f,	3.946f,	3.956f,	3.966f,	3.976f,	3.986f,	3.996f,	4.006f,	4.016f,	4.026f,	4.036f,	4.046f,	4.056f,	4.066f,	4.076f,	4.086f,	4.096f,	4.106f,	4.116f,	4.126f,	4.136f,	4.146f,	4.156f,	4.166f,	4.176f,	4.186f,	4.196f,	4.206f,	4.216f,	4.226f,	4.236f,	4.246f,	4.256f,	4.266f},
                     {3.985f, 3.935f, 3.885f, 3.835f, 3.785f,3.795f,	3.805f,	3.815f,	3.825f,	3.835f,	3.845f,	3.855f,	3.865f,	3.875f,	3.885f,	3.895f,	3.905f,	3.915f,	3.925f,	3.935f,	3.945f,	3.955f,	3.965f,	3.975f,	3.985f,	3.995f,	4.005f,	4.015f,	4.025f,	4.035f,	4.045f,	4.055f,	4.065f,	4.075f,	4.085f,	4.095f,	4.105f,	4.115f,	4.125f,	4.135f,	4.145f,	4.155f,	4.165f,	4.175f,	4.185f,	4.195f,	4.205f,	4.215f,	4.225f,	4.235f,	4.245f,	4.255f},
                     {3.980f, 3.930f, 3.880f, 3.830f, 3.780f,3.790f,	3.800f, 3.810f,	3.820f,	3.830f,	3.840f,	3.850f,	3.860f,	3.870f,	3.880f,	3.890f,	3.900f,	3.910f,	3.920f,	3.930f,	3.940f,	3.950f,	3.960f,	3.970f,	3.980f,	3.990f,	4.000f, 4.010f,	4.020f,	4.030f,	4.040f,	4.050f,	4.060f,	4.070f,	4.080f,	4.090f,	4.100f,	4.110f,	4.120f,	4.130f,	4.140f,	4.150f,	4.160f,	4.170f,	4.180f,	4.190f,	4.200f, 4.210f,	4.220f,	4.230f,	4.240f,	4.250f},
                     {3.889f, 3.839f, 3.789f, 3.739f, 3.689f,3.699f,	3.709f,	3.719f,	3.729f,	3.739f,	3.749f,	3.759f,	3.769f,	3.779f,	3.789f,	3.799f,	3.809f,	3.819f,	3.829f,	3.839f,	3.849f,	3.859f,	3.869f,	3.879f,	3.889f,	3.899f,	3.909f,	3.919f,	3.929f,	3.939f,	3.949f,	3.959f,	3.969f,	3.979f,	3.989f,	3.999f,	4.009f,	4.019f,	4.029f,	4.039f,	4.049f,	4.059f,	4.069f,	4.079f,	4.089f,	4.099f,	4.109f,	4.119f,	4.129f,	4.139f,	4.149f,	4.159f}},
        .vcell_max              = {4.096f, 4.046f, 3.996f, 3.946f, 3.896f, 3.906f, 3.916f, 3.926f, 3.936f, 3.946f, 3.956f, 3.966f, 3.976f, 3.986f, 3.996f, 4.006f, 4.016f, 4.026f, 4.036f, 4.046f, 4.056f, 4.066f, 4.076f, 4.086f, 4.096f, 4.106f, 4.116f, 4.126f, 4.136f, 4.146f, 4.156f, 4.166f, 4.176f, 4.186f, 4.196f, 4.206f, 4.216f, 4.226f, 4.236f, 4.246f, 4.256f, 4.266f, 4.276f, 4.286f, 4.296f, 4.306f, 4.316f, 4.326f, 4.336f, 4.346f, 4.356f, 4.366f},
        .vcell_min              = {3.889f, 3.839f, 3.789f, 3.739f, 3.689f, 3.699f, 3.709f, 3.719f, 3.729f, 3.739f, 3.749f, 3.759f, 3.769f, 3.779f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f},
        .balance_to_voltages    = {3.889f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f},
        .balance_gates_on       = {0x0FFF, 0x07FF, 0x0001, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0003, 0x0003, 0x0017, 0x027F, 0x07FF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF, 0x0FFF},
        .balance_gates_off      = {0x1000, 0x1000, 0x1FE8, 0x1FFE, 0x1FFF, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFC, 0x1FFC, 0x1FF8, 0x1FE8, 0x1D00, 0x1800, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000}
    },
    {
        .voltages = {{3.889f, 3.839f, 3.789f, 3.739f, 3.689f, 3.699f, 3.709f, 3.719f, 3.729f, 3.739f, 3.749f, 3.759f, 3.769f, 3.779f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f},
                     {3.992f, 3.942f, 3.892f, 3.842f, 3.792f, 3.802f, 3.812f, 3.822f, 3.832f, 3.842f, 3.852f, 3.862f, 3.872f, 3.882f, 3.892f, 3.902f, 3.912f, 3.922f, 3.932f, 3.942f, 3.952f, 3.962f, 3.972f, 3.982f, 3.992f, 4.002f, 4.012f, 4.022f, 4.032f, 4.042f, 4.052f, 4.062f, 4.072f, 4.082f, 4.092f, 4.102f, 4.112f, 4.122f, 4.132f, 4.142f, 4.152f, 4.162f, 4.172f, 4.182f, 4.192f, 4.202f, 4.212f, 4.222f, 4.232f, 4.242f, 4.252f, 4.262f},
                     {4.000f, 3.950f, 3.900f, 3.850f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f, 4.200f, 4.210f, 4.220f, 4.230f, 4.240f, 4.250f, 4.260f, 4.270f},
                     {3.887f, 3.837f, 3.787f, 3.737f, 3.687f, 3.697f, 3.707f, 3.717f, 3.727f, 3.737f, 3.747f, 3.757f, 3.767f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f, 3.847f, 3.857f, 3.867f, 3.877f, 3.887f, 3.897f, 3.907f, 3.917f, 3.927f, 3.937f, 3.947f, 3.957f, 3.967f, 3.977f, 3.987f, 3.997f, 4.007f, 4.017f, 4.027f, 4.037f, 4.047f, 4.057f, 4.067f, 4.077f, 4.087f, 4.097f, 4.107f, 4.117f, 4.127f, 4.137f, 4.147f, 4.157f},
                     {3.886f, 3.836f, 3.786f, 3.736f, 3.686f, 3.696f, 3.706f, 3.716f, 3.726f, 3.736f, 3.746f, 3.756f, 3.766f, 3.776f, 3.786f, 3.796f, 3.806f, 3.816f, 3.826f, 3.836f, 3.846f, 3.856f, 3.866f, 3.876f, 3.886f, 3.896f, 3.906f, 3.916f, 3.926f, 3.936f, 3.946f, 3.956f, 3.966f, 3.976f, 3.986f, 3.996f, 4.006f, 4.016f, 4.026f, 4.036f, 4.046f, 4.056f, 4.066f, 4.076f, 4.086f, 4.096f, 4.106f, 4.116f, 4.126f, 4.136f, 4.146f, 4.156f},
                     {3.878f, 3.828f, 3.778f, 3.728f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f},
                     {3.883f, 3.833f, 3.783f, 3.733f, 3.683f, 3.693f, 3.703f, 3.713f, 3.723f, 3.733f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f},
                     {3.965f, 3.915f, 3.865f, 3.815f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f, 4.175f, 4.185f, 4.195f, 4.205f, 4.215f, 4.225f, 4.235f},
                     {3.433f, 3.383f, 3.333f, 3.283f, 3.233f, 3.243f, 3.253f, 3.263f, 3.273f, 3.283f, 3.293f, 3.303f, 3.313f, 3.323f, 3.333f, 3.343f, 3.353f, 3.363f, 3.373f, 3.383f, 3.393f, 3.403f, 3.413f, 3.423f, 3.433f, 3.443f, 3.453f, 3.463f, 3.473f, 3.483f, 3.493f, 3.503f, 3.513f, 3.523f, 3.533f, 3.543f, 3.553f, 3.563f, 3.573f, 3.583f, 3.593f, 3.603f, 3.613f, 3.623f, 3.633f, 3.643f, 3.653f, 3.663f, 3.673f, 3.683f, 3.693f, 3.703f},
                     {3.234f, 3.184f, 3.134f, 3.084f, 3.034f, 3.044f, 3.054f, 3.064f, 3.074f, 3.084f, 3.094f, 3.104f, 3.114f, 3.124f, 3.134f, 3.144f, 3.154f, 3.164f, 3.174f, 3.184f, 3.194f, 3.204f, 3.214f, 3.224f, 3.234f, 3.244f, 3.254f, 3.264f, 3.274f, 3.284f, 3.294f, 3.304f, 3.314f, 3.324f, 3.334f, 3.344f, 3.354f, 3.364f, 3.374f, 3.384f, 3.394f, 3.404f, 3.414f, 3.424f, 3.434f, 3.444f, 3.454f, 3.464f, 3.474f, 3.484f, 3.494f, 3.504f},
                     {3.221f, 3.171f, 3.121f, 3.071f, 3.021f, 3.031f, 3.041f, 3.051f, 3.061f, 3.071f, 3.081f, 3.091f, 3.101f, 3.111f, 3.121f, 3.131f, 3.141f, 3.151f, 3.161f, 3.171f, 3.181f, 3.191f, 3.201f, 3.211f, 3.221f, 3.231f, 3.241f, 3.251f, 3.261f, 3.271f, 3.281f, 3.291f, 3.301f, 3.311f, 3.321f, 3.331f, 3.341f, 3.351f, 3.361f, 3.371f, 3.381f, 3.391f, 3.401f, 3.411f, 3.421f, 3.431f, 3.441f, 3.451f, 3.461f, 3.471f, 3.481f, 3.491f},
                     {3.299f, 3.249f, 3.199f, 3.149f, 3.099f, 3.109f, 3.119f, 3.129f, 3.139f, 3.149f, 3.159f, 3.169f, 3.179f, 3.189f, 3.199f, 3.209f, 3.219f, 3.229f, 3.239f, 3.249f, 3.259f, 3.269f, 3.279f, 3.289f, 3.299f, 3.309f, 3.319f, 3.329f, 3.339f, 3.349f, 3.359f, 3.369f, 3.379f, 3.389f, 3.399f, 3.409f, 3.419f, 3.429f, 3.439f, 3.449f, 3.459f, 3.469f, 3.479f, 3.489f, 3.499f, 3.509f, 3.519f, 3.529f, 3.539f, 3.549f, 3.559f, 3.569f},
                     {3.654f, 3.604f, 3.554f, 3.504f, 3.454f, 3.464f, 3.474f, 3.484f, 3.494f, 3.504f, 3.514f, 3.524f, 3.534f, 3.544f, 3.554f, 3.564f, 3.574f, 3.584f, 3.594f, 3.604f, 3.614f, 3.624f, 3.634f, 3.644f, 3.654f, 3.664f, 3.674f, 3.684f, 3.694f, 3.704f, 3.714f, 3.724f, 3.734f, 3.744f, 3.754f, 3.764f, 3.774f, 3.784f, 3.794f, 3.804f, 3.814f, 3.824f, 3.834f, 3.844f, 3.854f, 3.864f, 3.874f, 3.884f, 3.894f, 3.904f, 3.914f, 3.924f}},
        .vcell_max = {4.000f, 3.950f, 3.900f, 3.850f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f, 4.200f, 4.210f, 4.220f, 4.230f, 4.240f, 4.250f, 4.260f, 4.270f},
        .vcell_min              = {3.221f, 3.171f, 3.121f, 3.071f, 3.021f, 3.031f, 3.041f, 3.051f, 3.061f, 3.071f, 3.081f, 3.091f, 3.101f, 3.111f, 3.121f, 3.131f, 3.141f, 3.151f, 3.161f, 3.171f, 3.181f, 3.191f, 3.201f, 3.211f, 3.221f, 3.231f, 3.241f, 3.251f, 3.261f, 3.271f, 3.281f, 3.291f, 3.301f, 3.311f, 3.321f, 3.331f, 3.341f, 3.351f, 3.361f, 3.371f, 3.381f, 3.391f, 3.401f, 3.411f, 3.421f, 3.431f, 3.441f, 3.451f, 3.461f, 3.471f, 3.481f, 3.491f},
        .balance_to_voltages    = {3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f},
        .balance_gates_on       = {0x0086, 0x0006, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0004, 0x0006, 0x0006, 0x0086, 0x0086, 0x0086, 0x0086, 0x0086, 0x0086, 0x0086, 0x0086, 0x00DF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF, 0x00FF},
        .balance_gates_off      = {0x1F79, 0x1F79, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FF9, 0x1FF9, 0x1FF9, 0x1F79, 0x1F79, 0x1F79, 0x1F79, 0x1F79, 0x1F79, 0x1F79, 0x1F79, 0x1F20, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x1F00, 0x0F00, 0x0F00, 0x0F00}
    },
    {
        .voltages = {{3.887f, 3.837f, 3.787f, 3.737f, 3.687f, 3.697f, 3.707f, 3.717f, 3.727f, 3.737f, 3.747f, 3.757f, 3.767f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f, 3.847f, 3.857f, 3.867f, 3.877f, 3.887f, 3.897f, 3.907f, 3.917f, 3.927f, 3.937f, 3.947f, 3.957f, 3.967f, 3.977f, 3.987f, 3.997f, 4.007f, 4.017f, 4.027f, 4.037f, 4.047f, 4.057f, 4.067f, 4.077f, 4.087f, 4.097f, 4.107f, 4.117f, 4.127f, 4.137f, 4.147f, 4.157f},
                     {3.886f, 3.836f, 3.786f, 3.736f, 3.686f, 3.696f, 3.706f, 3.716f, 3.726f, 3.736f, 3.746f, 3.756f, 3.766f, 3.776f, 3.786f, 3.796f, 3.806f, 3.816f, 3.826f, 3.836f, 3.846f, 3.856f, 3.866f, 3.876f, 3.886f, 3.896f, 3.906f, 3.916f, 3.926f, 3.936f, 3.946f, 3.956f, 3.966f, 3.976f, 3.986f, 3.996f, 4.006f, 4.016f, 4.026f, 4.036f, 4.046f, 4.056f, 4.066f, 4.076f, 4.086f, 4.096f, 4.106f, 4.116f, 4.126f, 4.136f, 4.146f, 4.156f},
                     {3.878f, 3.828f, 3.778f, 3.728f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f},
                     {3.883f, 3.833f, 3.783f, 3.733f, 3.683f, 3.693f, 3.703f, 3.713f, 3.723f, 3.733f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f},
                     {3.965f, 3.915f, 3.865f, 3.815f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f, 4.175f, 4.185f, 4.195f, 4.205f, 4.215f, 4.225f, 4.235f},
                     {4.001f, 3.951f, 3.901f, 3.851f, 3.801f, 3.811f, 3.821f, 3.831f, 3.841f, 3.851f, 3.861f, 3.871f, 3.881f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f, 4.181f, 4.191f, 4.201f, 4.211f, 4.221f, 4.231f, 4.241f, 4.251f, 4.261f, 4.271f},
                     {4.004f, 3.954f, 3.904f, 3.854f, 3.804f, 3.814f, 3.824f, 3.834f, 3.844f, 3.854f, 3.864f, 3.874f, 3.884f, 3.894f, 3.904f, 3.914f, 3.924f, 3.934f, 3.944f, 3.954f, 3.964f, 3.974f, 3.984f, 3.994f, 4.004f, 4.014f, 4.024f, 4.034f, 4.044f, 4.054f, 4.064f, 4.074f, 4.084f, 4.094f, 4.104f, 4.114f, 4.124f, 4.134f, 4.144f, 4.154f, 4.164f, 4.174f, 4.184f, 4.194f, 4.204f, 4.214f, 4.224f, 4.234f, 4.244f, 4.254f, 4.264f, 4.274f},
                     {4.008f, 3.958f, 3.908f, 3.858f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f, 4.248f, 4.258f, 4.268f, 4.278f},
                     {4.010f, 3.960f, 3.910f, 3.860f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f, 4.200f, 4.210f, 4.220f, 4.230f, 4.240f, 4.250f, 4.260f, 4.270f, 4.280f},
                     {3.888f, 3.838f, 3.788f, 3.738f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f},
                     {3.789f, 3.739f, 3.689f, 3.639f, 3.589f, 3.599f, 3.609f, 3.619f, 3.629f, 3.639f, 3.649f, 3.659f, 3.669f, 3.679f, 3.689f, 3.699f, 3.709f, 3.719f, 3.729f, 3.739f, 3.749f, 3.759f, 3.769f, 3.779f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f},
                     {3.567f, 3.517f, 3.467f, 3.417f, 3.367f, 3.377f, 3.387f, 3.397f, 3.407f, 3.417f, 3.427f, 3.437f, 3.447f, 3.457f, 3.467f, 3.477f, 3.487f, 3.497f, 3.507f, 3.517f, 3.527f, 3.537f, 3.547f, 3.557f, 3.567f, 3.577f, 3.587f, 3.597f, 3.607f, 3.617f, 3.627f, 3.637f, 3.647f, 3.657f, 3.667f, 3.677f, 3.687f, 3.697f, 3.707f, 3.717f, 3.727f, 3.737f, 3.747f, 3.757f, 3.767f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f},
                     {3.956f, 3.906f, 3.856f, 3.806f, 3.756f, 3.766f, 3.776f, 3.786f, 3.796f, 3.806f, 3.816f, 3.826f, 3.836f, 3.846f, 3.856f, 3.866f, 3.876f, 3.886f, 3.896f, 3.906f, 3.916f, 3.926f, 3.936f, 3.946f, 3.956f, 3.966f, 3.976f, 3.986f, 3.996f, 4.006f, 4.016f, 4.026f, 4.036f, 4.046f, 4.056f, 4.066f, 4.076f, 4.086f, 4.096f, 4.106f, 4.116f, 4.126f, 4.136f, 4.146f, 4.156f, 4.166f, 4.176f, 4.186f, 4.196f, 4.206f, 4.216f, 4.226f}},
        .vcell_max              = {4.010f, 3.960f, 3.910f, 3.860f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f, 4.200f, 4.210f, 4.220f, 4.230f, 4.240f, 4.250f, 4.260f, 4.270f, 4.280f},
        .vcell_min              = {3.567f, 3.517f, 3.467f, 3.417f, 3.367f, 3.377f, 3.387f, 3.397f, 3.407f, 3.417f, 3.427f, 3.437f, 3.447f, 3.457f, 3.467f, 3.477f, 3.487f, 3.497f, 3.507f, 3.517f, 3.527f, 3.537f, 3.547f, 3.557f, 3.567f, 3.577f, 3.587f, 3.597f, 3.607f, 3.617f, 3.627f, 3.637f, 3.647f, 3.657f, 3.667f, 3.677f, 3.687f, 3.697f, 3.707f, 3.717f, 3.727f, 3.737f, 3.747f, 3.757f, 3.767f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f},
        .balance_to_voltages    = {3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f},
        .balance_gates_on       = {0x11F0, 0x01E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01E0, 0x01E0, 0x01E0, 0x01F0, 0x11F0, 0x11F0, 0x11F0, 0x11F0, 0x11F0, 0x11F0, 0x11F0, 0x13FB, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x13FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF, 0x17FF},
        .balance_gates_off      = {0x0E0F, 0x0E0F, 0x1E3F, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1E3F, 0x1E1F, 0x1E1F, 0x1E1F, 0x1E0F, 0x0E0F, 0x0E0F, 0x0E0F, 0x0E0F, 0x0E0F, 0x0E0F, 0x0E0F, 0x0C04, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0C00, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800}
    },

    {
        .voltages = {{3.887f, 3.837f, 3.787f, 3.737f, 3.687f, 3.697f, 3.707f, 3.717f, 3.727f, 3.737f, 3.747f, 3.757f, 3.767f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f, 3.847f, 3.857f, 3.867f, 3.877f, 3.887f, 3.897f, 3.907f, 3.917f, 3.927f, 3.937f, 3.947f, 3.957f, 3.967f, 3.977f, 3.987f, 3.997f, 4.007f, 4.017f, 4.027f, 4.037f, 4.047f, 4.057f, 4.067f, 4.077f, 4.087f, 4.097f, 4.107f, 4.117f, 4.127f, 4.137f, 4.147f, 4.157f},
                     {3.892f, 3.842f, 3.792f, 3.742f, 3.692f, 3.702f, 3.712f, 3.722f, 3.732f, 3.742f, 3.752f, 3.762f, 3.772f, 3.782f, 3.792f, 3.802f, 3.812f, 3.822f, 3.832f, 3.842f, 3.852f, 3.862f, 3.872f, 3.882f, 3.892f, 3.902f, 3.912f, 3.922f, 3.932f, 3.942f, 3.952f, 3.962f, 3.972f, 3.982f, 3.992f, 4.002f, 4.012f, 4.022f, 4.032f, 4.042f, 4.052f, 4.062f, 4.072f, 4.082f, 4.092f, 4.102f, 4.112f, 4.122f, 4.132f, 4.142f, 4.152f, 4.162f},
                     {3.878f, 3.828f, 3.778f, 3.728f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f},
                     {3.899f, 3.849f, 3.799f, 3.749f, 3.699f, 3.709f, 3.719f, 3.729f, 3.739f, 3.749f, 3.759f, 3.769f, 3.779f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f, 4.169f},
                     {3.900f, 3.850f, 3.800f, 3.750f, 3.700f, 3.710f, 3.720f, 3.730f, 3.740f, 3.750f, 3.760f, 3.770f, 3.780f, 3.790f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f},
                     {3.910f, 3.860f, 3.810f, 3.760f, 3.710f, 3.720f, 3.730f, 3.740f, 3.750f, 3.760f, 3.770f, 3.780f, 3.790f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f},
                     {3.920f, 3.870f, 3.820f, 3.770f, 3.720f, 3.730f, 3.740f, 3.750f, 3.760f, 3.770f, 3.780f, 3.790f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f},
                     {3.933f, 3.883f, 3.833f, 3.783f, 3.733f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f, 4.203f},
                     {3.943f, 3.893f, 3.843f, 3.793f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f, 4.203f, 4.213f},
                     {3.948f, 3.898f, 3.848f, 3.798f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f},
                     {3.955f, 3.905f, 3.855f, 3.805f, 3.755f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f, 4.175f, 4.185f, 4.195f, 4.205f, 4.215f, 4.225f},
                     {3.966f, 3.916f, 3.866f, 3.816f, 3.766f, 3.776f, 3.786f, 3.796f, 3.806f, 3.816f, 3.826f, 3.836f, 3.846f, 3.856f, 3.866f, 3.876f, 3.886f, 3.896f, 3.906f, 3.916f, 3.926f, 3.936f, 3.946f, 3.956f, 3.966f, 3.976f, 3.986f, 3.996f, 4.006f, 4.016f, 4.026f, 4.036f, 4.046f, 4.056f, 4.066f, 4.076f, 4.086f, 4.096f, 4.106f, 4.116f, 4.126f, 4.136f, 4.146f, 4.156f, 4.166f, 4.176f, 4.186f, 4.196f, 4.206f, 4.216f, 4.226f, 4.236f},
                     {3.977f, 3.927f, 3.877f, 3.827f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f, 3.847f, 3.857f, 3.867f, 3.877f, 3.887f, 3.897f, 3.907f, 3.917f, 3.927f, 3.937f, 3.947f, 3.957f, 3.967f, 3.977f, 3.987f, 3.997f, 4.007f, 4.017f, 4.027f, 4.037f, 4.047f, 4.057f, 4.067f, 4.077f, 4.087f, 4.097f, 4.107f, 4.117f, 4.127f, 4.137f, 4.147f, 4.157f, 4.167f, 4.177f, 4.187f, 4.197f, 4.207f, 4.217f, 4.227f, 4.237f, 4.247f}},
        .vcell_max              = {3.977f, 3.927f, 3.877f, 3.827f, 3.777f, 3.787f, 3.797f, 3.807f, 3.817f, 3.827f, 3.837f, 3.847f, 3.857f, 3.867f, 3.877f, 3.887f, 3.897f, 3.907f, 3.917f, 3.927f, 3.937f, 3.947f, 3.957f, 3.967f, 3.977f, 3.987f, 3.997f, 4.007f, 4.017f, 4.027f, 4.037f, 4.047f, 4.057f, 4.067f, 4.077f, 4.087f, 4.097f, 4.107f, 4.117f, 4.127f, 4.137f, 4.147f, 4.157f, 4.167f, 4.177f, 4.187f, 4.197f, 4.207f, 4.217f, 4.227f, 4.237f, 4.247f},
        .vcell_min              = {3.878f, 3.828f, 3.778f, 3.728f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f},
        .balance_to_voltages    = {3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f},
        .balance_gates_on       = {0x1F80, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1000, 0x1800, 0x1C00, 0x1F00, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80, 0x1F80},
        .balance_gates_off      = {0x001F, 0x03FF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x0FFF, 0x07FF, 0x03FF, 0x00FF, 0x007F, 0x007F, 0x003F, 0x001F, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007}

    },
    {
        .voltages = {{3.998f, 3.948f, 3.898f, 3.848f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f, 4.248f, 4.258f, 4.268f},
                     {3.989f, 3.939f, 3.889f, 3.839f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f, 4.169f, 4.179f, 4.189f, 4.199f, 4.209f, 4.219f, 4.229f, 4.239f, 4.249f, 4.259f},
                     {3.978f, 3.928f, 3.878f, 3.828f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f, 4.248f},
                     {3.943f, 3.893f, 3.843f, 3.793f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f, 4.203f, 4.213f},
                     {3.934f, 3.884f, 3.834f, 3.784f, 3.734f, 3.744f, 3.754f, 3.764f, 3.774f, 3.784f, 3.794f, 3.804f, 3.814f, 3.824f, 3.834f, 3.844f, 3.854f, 3.864f, 3.874f, 3.884f, 3.894f, 3.904f, 3.914f, 3.924f, 3.934f, 3.944f, 3.954f, 3.964f, 3.974f, 3.984f, 3.994f, 4.004f, 4.014f, 4.024f, 4.034f, 4.044f, 4.054f, 4.064f, 4.074f, 4.084f, 4.094f, 4.104f, 4.114f, 4.124f, 4.134f, 4.144f, 4.154f, 4.164f, 4.174f, 4.184f, 4.194f, 4.204f},
                     {3.965f, 3.915f, 3.865f, 3.815f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f, 4.175f, 4.185f, 4.195f, 4.205f, 4.215f, 4.225f, 4.235f},
                     {3.968f, 3.918f, 3.868f, 3.818f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f},
                     {3.911f, 3.861f, 3.811f, 3.761f, 3.711f, 3.721f, 3.731f, 3.741f, 3.751f, 3.761f, 3.771f, 3.781f, 3.791f, 3.801f, 3.811f, 3.821f, 3.831f, 3.841f, 3.851f, 3.861f, 3.871f, 3.881f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f, 4.181f},
                     {3.910f, 3.860f, 3.810f, 3.760f, 3.710f, 3.720f, 3.730f, 3.740f, 3.750f, 3.760f, 3.770f, 3.780f, 3.790f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f},
                     {3.901f, 3.851f, 3.801f, 3.751f, 3.701f, 3.711f, 3.721f, 3.731f, 3.741f, 3.751f, 3.761f, 3.771f, 3.781f, 3.791f, 3.801f, 3.811f, 3.821f, 3.831f, 3.841f, 3.851f, 3.861f, 3.871f, 3.881f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f},
                     {3.905f, 3.855f, 3.805f, 3.755f, 3.705f, 3.715f, 3.725f, 3.735f, 3.745f, 3.755f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f, 4.175f},
                     {3.923f, 3.873f, 3.823f, 3.773f, 3.723f, 3.733f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f},
                     {3.960f, 3.910f, 3.860f, 3.810f, 3.760f, 3.770f, 3.780f, 3.790f, 3.800f, 3.810f, 3.820f, 3.830f, 3.840f, 3.850f, 3.860f, 3.870f, 3.880f, 3.890f, 3.900f, 3.910f, 3.920f, 3.930f, 3.940f, 3.950f, 3.960f, 3.970f, 3.980f, 3.990f, 4.000f, 4.010f, 4.020f, 4.030f, 4.040f, 4.050f, 4.060f, 4.070f, 4.080f, 4.090f, 4.100f, 4.110f, 4.120f, 4.130f, 4.140f, 4.150f, 4.160f, 4.170f, 4.180f, 4.190f, 4.200f, 4.210f, 4.220f, 4.230f}},
        .vcell_max              = {3.998f, 3.948f, 3.898f, 3.848f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f, 4.248f, 4.258f, 4.268f},
        .vcell_min              = {3.901f, 3.851f, 3.801f, 3.751f, 3.701f, 3.711f, 3.721f, 3.731f, 3.741f, 3.751f, 3.761f, 3.771f, 3.781f, 3.791f, 3.801f, 3.811f, 3.821f, 3.831f, 3.841f, 3.851f, 3.861f, 3.871f, 3.881f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f},
        .balance_to_voltages    = {3.901f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f},
        .balance_gates_on       = {0x1067, 0x0003, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0003, 0x0007, 0x0067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067, 0x1067},
        .balance_gates_off      = {0x0780, 0x0F98, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFF, 0x1FFE, 0x1FFC, 0x1FF8, 0x1F98, 0x0F98, 0x0F90, 0x0F80, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780, 0x0780}
    },
    {
        .voltages = {{3.678f, 3.628f, 3.578f, 3.528f, 3.478f, 3.488f, 3.498f, 3.508f, 3.518f, 3.528f, 3.538f, 3.548f, 3.558f, 3.568f, 3.578f, 3.588f, 3.598f, 3.608f, 3.618f, 3.628f, 3.638f, 3.648f, 3.658f, 3.668f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f},
                     {4.012f, 3.962f, 3.912f, 3.862f, 3.812f, 3.822f, 3.832f, 3.842f, 3.852f, 3.862f, 3.872f, 3.882f, 3.892f, 3.902f, 3.912f, 3.922f, 3.932f, 3.942f, 3.952f, 3.962f, 3.972f, 3.982f, 3.992f, 4.002f, 4.012f, 4.022f, 4.032f, 4.042f, 4.052f, 4.062f, 4.072f, 4.082f, 4.092f, 4.102f, 4.112f, 4.122f, 4.132f, 4.142f, 4.152f, 4.162f, 4.172f, 4.182f, 4.192f, 4.202f, 4.212f, 4.222f, 4.232f, 4.242f, 4.252f, 4.262f, 4.272f, 4.282f},
                     {4.014f, 3.964f, 3.914f, 3.864f, 3.814f, 3.824f, 3.834f, 3.844f, 3.854f, 3.864f, 3.874f, 3.884f, 3.894f, 3.904f, 3.914f, 3.924f, 3.934f, 3.944f, 3.954f, 3.964f, 3.974f, 3.984f, 3.994f, 4.004f, 4.014f, 4.024f, 4.034f, 4.044f, 4.054f, 4.064f, 4.074f, 4.084f, 4.094f, 4.104f, 4.114f, 4.124f, 4.134f, 4.144f, 4.154f, 4.164f, 4.174f, 4.184f, 4.194f, 4.204f, 4.214f, 4.224f, 4.234f, 4.244f, 4.254f, 4.264f, 4.274f, 4.284f},
                     {4.011f, 3.961f, 3.911f, 3.861f, 3.811f, 3.821f, 3.831f, 3.841f, 3.851f, 3.861f, 3.871f, 3.881f, 3.891f, 3.901f, 3.911f, 3.921f, 3.931f, 3.941f, 3.951f, 3.961f, 3.971f, 3.981f, 3.991f, 4.001f, 4.011f, 4.021f, 4.031f, 4.041f, 4.051f, 4.061f, 4.071f, 4.081f, 4.091f, 4.101f, 4.111f, 4.121f, 4.131f, 4.141f, 4.151f, 4.161f, 4.171f, 4.181f, 4.191f, 4.201f, 4.211f, 4.221f, 4.231f, 4.241f, 4.251f, 4.261f, 4.271f, 4.281f},
                     {4.008f, 3.958f, 3.908f, 3.858f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f, 3.958f, 3.968f, 3.978f, 3.988f, 3.998f, 4.008f, 4.018f, 4.028f, 4.038f, 4.048f, 4.058f, 4.068f, 4.078f, 4.088f, 4.098f, 4.108f, 4.118f, 4.128f, 4.138f, 4.148f, 4.158f, 4.168f, 4.178f, 4.188f, 4.198f, 4.208f, 4.218f, 4.228f, 4.238f, 4.248f, 4.258f, 4.268f, 4.278f},
                     {4.123f, 4.073f, 4.023f, 3.973f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f, 4.203f, 4.213f, 4.223f, 4.233f, 4.243f, 4.253f, 4.263f, 4.273f, 4.283f, 4.293f, 4.303f, 4.313f, 4.323f, 4.333f, 4.343f, 4.353f, 4.363f, 4.373f, 4.383f, 4.393f},
                     {4.034f, 3.984f, 3.934f, 3.884f, 3.834f, 3.844f, 3.854f, 3.864f, 3.874f, 3.884f, 3.894f, 3.904f, 3.914f, 3.924f, 3.934f, 3.944f, 3.954f, 3.964f, 3.974f, 3.984f, 3.994f, 4.004f, 4.014f, 4.024f, 4.034f, 4.044f, 4.054f, 4.064f, 4.074f, 4.084f, 4.094f, 4.104f, 4.114f, 4.124f, 4.134f, 4.144f, 4.154f, 4.164f, 4.174f, 4.184f, 4.194f, 4.204f, 4.214f, 4.224f, 4.234f, 4.244f, 4.254f, 4.264f, 4.274f, 4.284f, 4.294f, 4.304f},
                     {3.893f, 3.843f, 3.793f, 3.743f, 3.693f, 3.703f, 3.713f, 3.723f, 3.733f, 3.743f, 3.753f, 3.763f, 3.773f, 3.783f, 3.793f, 3.803f, 3.813f, 3.823f, 3.833f, 3.843f, 3.853f, 3.863f, 3.873f, 3.883f, 3.893f, 3.903f, 3.913f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f},
                     {3.885f, 3.835f, 3.785f, 3.735f, 3.685f, 3.695f, 3.705f, 3.715f, 3.725f, 3.735f, 3.745f, 3.755f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f},
                     {3.889f, 3.839f, 3.789f, 3.739f, 3.689f, 3.699f, 3.709f, 3.719f, 3.729f, 3.739f, 3.749f, 3.759f, 3.769f, 3.779f, 3.789f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f},
                     {3.892f, 3.842f, 3.792f, 3.742f, 3.692f, 3.702f, 3.712f, 3.722f, 3.732f, 3.742f, 3.752f, 3.762f, 3.772f, 3.782f, 3.792f, 3.802f, 3.812f, 3.822f, 3.832f, 3.842f, 3.852f, 3.862f, 3.872f, 3.882f, 3.892f, 3.902f, 3.912f, 3.922f, 3.932f, 3.942f, 3.952f, 3.962f, 3.972f, 3.982f, 3.992f, 4.002f, 4.012f, 4.022f, 4.032f, 4.042f, 4.052f, 4.062f, 4.072f, 4.082f, 4.092f, 4.102f, 4.112f, 4.122f, 4.132f, 4.142f, 4.152f, 4.162f},
                     {3.895f, 3.845f, 3.795f, 3.745f, 3.695f, 3.705f, 3.715f, 3.725f, 3.735f, 3.745f, 3.755f, 3.765f, 3.775f, 3.785f, 3.795f, 3.805f, 3.815f, 3.825f, 3.835f, 3.845f, 3.855f, 3.865f, 3.875f, 3.885f, 3.895f, 3.905f, 3.915f, 3.925f, 3.935f, 3.945f, 3.955f, 3.965f, 3.975f, 3.985f, 3.995f, 4.005f, 4.015f, 4.025f, 4.035f, 4.045f, 4.055f, 4.065f, 4.075f, 4.085f, 4.095f, 4.105f, 4.115f, 4.125f, 4.135f, 4.145f, 4.155f, 4.165f},
                     {3.999f, 3.949f, 3.899f, 3.849f, 3.799f, 3.809f, 3.819f, 3.829f, 3.839f, 3.849f, 3.859f, 3.869f, 3.879f, 3.889f, 3.899f, 3.909f, 3.919f, 3.929f, 3.939f, 3.949f, 3.959f, 3.969f, 3.979f, 3.989f, 3.999f, 4.009f, 4.019f, 4.029f, 4.039f, 4.049f, 4.059f, 4.069f, 4.079f, 4.089f, 4.099f, 4.109f, 4.119f, 4.129f, 4.139f, 4.149f, 4.159f, 4.169f, 4.179f, 4.189f, 4.199f, 4.209f, 4.219f, 4.229f, 4.239f, 4.249f, 4.259f, 4.269f}},
        .vcell_max              = {4.123f, 4.073f, 4.023f, 3.973f, 3.923f, 3.933f, 3.943f, 3.953f, 3.963f, 3.973f, 3.983f, 3.993f, 4.003f, 4.013f, 4.023f, 4.033f, 4.043f, 4.053f, 4.063f, 4.073f, 4.083f, 4.093f, 4.103f, 4.113f, 4.123f, 4.133f, 4.143f, 4.153f, 4.163f, 4.173f, 4.183f, 4.193f, 4.203f, 4.213f, 4.223f, 4.233f, 4.243f, 4.253f, 4.263f, 4.273f, 4.283f, 4.293f, 4.303f, 4.313f, 4.323f, 4.333f, 4.343f, 4.353f, 4.363f, 4.373f, 4.383f, 4.393f},
        .vcell_min              = {3.678f, 3.628f, 3.578f, 3.528f, 3.478f, 3.488f, 3.498f, 3.508f, 3.518f, 3.528f, 3.538f, 3.548f, 3.558f, 3.568f, 3.578f, 3.588f, 3.598f, 3.608f, 3.618f, 3.628f, 3.638f, 3.648f, 3.658f, 3.668f, 3.678f, 3.688f, 3.698f, 3.708f, 3.718f, 3.728f, 3.738f, 3.748f, 3.758f, 3.768f, 3.778f, 3.788f, 3.798f, 3.808f, 3.818f, 3.828f, 3.838f, 3.848f, 3.858f, 3.868f, 3.878f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f},
        .balance_to_voltages    = {3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.882f, 3.888f, 3.898f, 3.908f, 3.918f, 3.928f, 3.938f, 3.948f},
        .balance_gates_on       = {0x107E, 0x107E, 0x0060, 0x0020, 0x0000, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0060, 0x0060, 0x0064, 0x007E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x107E, 0x18FE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE, 0x1FFE},
        .balance_gates_off      = {0x0F81, 0x0F81, 0x1F81, 0x1FDF, 0x1FDF, 0x1FDF, 0x1FDF, 0x1FDF, 0x1FDF, 0x1FDF, 0x1FDF, 0x1F9F, 0x1F9F, 0x1F99, 0x1F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0F81, 0x0301, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001}
    }

};

uint8_t calculate_unit_test_results[2][ MAX_NUM_CORES ][UT_SC_TEST_COUNT];

void run_bms_app_balance_calculate_unit_test()
{
    memset ( calculate_unit_test_results, 0, sizeof( calculate_unit_test_results ));

    uint16_t testId = 0;
    for( ;testId < UT_SC_TEST_COUNT; ++testId )
    {
        uint16_t moduleId = 0;
        for( ;moduleId < MAX_NUM_CORES ; ++moduleId )
        {
            uint16_t cellId = 0;
            for( ;cellId < MAX_NUM_CELLS_PER_CORE; ++cellId )
            {
                gCoreDataSlow[moduleId].voltages[cellId] = testDataCellVoltages[ moduleId ].voltages[cellId][testId];
                gCoreDataSlow[moduleId].temperatures[0] = 25.0f;
                gCoreDataSlow[moduleId].temperatures[1] = 25.0f;

                gCoreDataSlow[moduleId].max_cell_voltage = testDataCellVoltages[ moduleId ].vcell_max[testId];
                gCoreDataSlow[moduleId].min_cell_voltage = testDataCellVoltages[ moduleId ].vcell_min[testId];
            }
        }

        bms_app_balance_start_calculate();

        //Check the balance gate settings
        for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
        {
            if( sBalanceVoltage[ moduleId ] == testDataCellVoltages[ moduleId ].balance_to_voltages[testId] )
            {
                if( gCoreDataSlow[moduleId].balance == testDataCellVoltages[ moduleId ].balance_gates_on[testId] )
                {
                    calculate_unit_test_results[0][moduleId][ testId ] = 1;
                }
            }
        }

        bms_app_balance_update_calculate();
        //Check the balance gate settings
        for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
        {
            if( sBalanceVoltage[ moduleId ] == testDataCellVoltages[ moduleId ].balance_to_voltages[testId] )
            {
                if( gCoreDataSlow[moduleId].balance == testDataCellVoltages[ moduleId ].balance_gates_on[testId] )
                {
                    calculate_unit_test_results[1][moduleId][ testId ] = 1;
                }
            }
        }
    }
}

uint8_t get_group_mask_unit_test_results = 1;
void run_bms_app_balance_get_group_mask_uint_test()
{
    sBalanceActiveGroup = 0;
    if( BMS_APP_BALANCE_GROUP_ONE_MASK != bms_app_balance_get_group_mask() )
    {
        get_group_mask_unit_test_results = 0;
    }

    if( BMS_APP_BALANCE_GROUP_TWO_MASK != bms_app_balance_get_group_mask() )
    {
        get_group_mask_unit_test_results = 0;
    }

    if( BMS_APP_BALANCE_GROUP_THREE_MASK != bms_app_balance_get_group_mask() )
    {
        get_group_mask_unit_test_results = 0;
    }

    if( BMS_APP_BALANCE_GROUP_ONE_MASK != bms_app_balance_get_group_mask() )
    {
        get_group_mask_unit_test_results = 0;
    }
}

uint8_t update_times_unit_test = 1;
void run_bms_app_balance_update_times_unit_test( )
{
    sBalanceSessionTimerStartMs = 1234ull;
    sBalanceSessionTimeSeconds  = 0;
    
    sBalanceTimerStartMs        = 5678.0f;
    sBalanceTimeSeconds         = 0;

    utils_get_elapsed_time_ms_64_restart_value = 23000;
    utils_get_elapsed_time_ms_restart_value = 43000;

    bms_app_balance_update_times();
    
    if( 0 == sBalanceSessionTimerStartMs )
    {
        update_times_unit_test = 0;
    }
    
    if( 23 == sBalanceSessionTimeSeconds )
    {
        update_times_unit_test = 0;
    }
    
    if( 0 == sBalanceTimeSeconds )
    {
        update_times_unit_test = 0;
    }
    
    if( 43 == sBalanceTimeSeconds )
    {
        update_times_unit_test = 0;
    }
}

uint8_t balance_gates_start_test[4][MAX_NUM_CORES];
void run_bms_app_balance_start_test()
{
    memset( balance_gates_start_test, 0, sizeof( balance_gates_start_test ) );

    uint16_t moduleId = 0;
    for( ;moduleId < MAX_NUM_CORES; ++moduleId )
    {
        gCoreDataSlow[ moduleId ].balance = 0xffff;
    }

    sBalanceActiveGroup = 0;

    uint16_t testId = 0;
    for(; testId < 4; ++testId )
    {
        bms_app_balance_start();
        gBatteryStatus.bits.balancing_gates = 0;
        
        for( moduleId = 0 ;moduleId < MAX_NUM_CORES; ++moduleId )
        {
            uint16_t  group = 0;
            switch( sBalanceActiveGroup )
            {
                case 0:
                    group = BMS_APP_BALANCE_GROUP_ONE_MASK;
                    break;

                case 1:
                    group = BMS_APP_BALANCE_GROUP_TWO_MASK;
                    break;

                case 2:
                    group = BMS_APP_BALANCE_GROUP_THREE_MASK;
                    break;
            }

            if( balance_gates_record[ moduleId ] == (gCoreDataSlow[ moduleId ].balance & group ) )
            {
                if( gBatteryStatus.bits.balancing_gates & (1 << moduleId) )
                {
                    balance_gates_start_test[testId][moduleId] = 1;
                }
            }
        }
    }
}

uint8_t balance_gates_stop_test_results[MAX_NUM_CORES];
void run_bms_app_balance_stop_test()
{
    memset( balance_gates_stop_test_results, 0, sizeof( balance_gates_stop_test_results ) );
    bms_app_balance_stop();

    uint16_t moduleId = 0;
    for( moduleId = 0 ;moduleId < MAX_NUM_CORES; ++moduleId )
    {
        if( 0 == balance_gates_record[ moduleId ] )
        {
            balance_gates_stop_test_results[moduleId] = 1;
        }
    }
}


void load_voltage_data( uint16_t testId )
{
    uint16_t moduleId = 0;
    for( ;moduleId < MAX_NUM_CORES ; ++moduleId )
    {
        uint16_t cellId = 0;
        for( ;cellId < MAX_NUM_CELLS_PER_CORE; ++cellId )
        {
            gCoreDataSlow[moduleId].voltages[cellId] = testDataCellVoltages[ moduleId ].voltages[cellId][testId];
            gCoreDataSlow[moduleId].temperatures[0] = 25.0f;
            gCoreDataSlow[moduleId].temperatures[1] = 25.0f;

            gCoreDataSlow[moduleId].max_cell_voltage = testDataCellVoltages[ moduleId ].vcell_max[testId];
            gCoreDataSlow[moduleId].min_cell_voltage = testDataCellVoltages[ moduleId ].vcell_min[testId];
        }
    }
}


#define CHECK_PROGRESS_BAL_ON_ITERATIONS    (5)
#define CHECK_PROGRESS_BAL_OFF_ITERATIONS   (5)

uint8_t balance_check_progress_test_results[3][MAX_NUM_CORES];
void run_bms_app_balance_check_progress_test()
{
    gBatteryStatus.bits.balancing_session = 1;
    memset( balance_check_progress_test_results, 0, sizeof( balance_check_progress_test_results ) );
    run_bms_app_balance_start_test();       //This will set balance gates on

    //First call will have timers set to zero  this should cause check progress to do nothing
    //We should be able to call check progress 5 times before the balance gates are turned off
    sBalanceSessionTimerStartMs = 1234ull;
    sBalanceSessionTimeSeconds  = 0;

    sBalanceTimerStartMs        = 5678.0f;
    sBalanceTimeSeconds         = 0;

    utils_get_elapsed_time_ms_64_restart_value = 0;
    utils_get_elapsed_time_ms_restart_value = TBAL_GATE_CLOSE_MSEC/CHECK_PROGRESS_BAL_ON_ITERATIONS;

    uint16_t moduleId = 0;
    uint16_t iteration = 0;
    for( ;iteration < CHECK_PROGRESS_BAL_ON_ITERATIONS-1; ++iteration )
    {
        bms_app_balance_check_progress();

        for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
        {
            if( 0 != balance_gates_record[ moduleId ] )
            {
                balance_check_progress_test_results[0][moduleId] = 1;
            }
            else
            {
                balance_check_progress_test_results[0][moduleId] = 0;
            }
        }
    }

    bms_app_balance_check_progress();
    for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
    {
        //Last iteration should reset balance gates
        if( 0 == balance_gates_record[ moduleId ] )
        {
            balance_check_progress_test_results[0][moduleId] = 1;
        }
        else
        {
            balance_check_progress_test_results[0][moduleId] = 0;
        }
    }

    //Loads voltages to test the gates off test in check progress.
    //NOTE:  We're not testing the balance gates off this time around.
    load_voltage_data( 0 );

    //Now check the time to turn the balance gates back on
    utils_get_elapsed_time_ms_restart_value = TBAL_GATE_OPEN_MSEC/CHECK_PROGRESS_BAL_OFF_ITERATIONS;
    for( ;iteration < CHECK_PROGRESS_BAL_OFF_ITERATIONS-1; ++iteration )
    {
        bms_app_balance_check_progress();

        for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
        {
            if( 0 == balance_gates_record[ moduleId ] )
            {
                balance_check_progress_test_results[1][moduleId] = 1;
            }
            else
            {
                balance_check_progress_test_results[1][moduleId] = 0;
            }
        }
    }

    bms_app_balance_check_progress();
    for( moduleId = 0; moduleId < MAX_NUM_CORES; ++moduleId )
    {
        //Last iteration should reset balance gates
        if( 0 != balance_gates_record[ moduleId ] )
        {
            balance_check_progress_test_results[1][moduleId] = 1;
        }
        else
        {
            balance_check_progress_test_results[1][moduleId] = 0;
        }
    }

    //Other tests to add would be (in addition to the gates off check)
    //to see if the session is stopped if no balance gates turn on
}


/*
 * Test each status point.  
 * 0.  Idle current and Idle current timeout (true)
 * 1.  Current is greater than idle current  (false)
 * 2.  Current is idle, but it hasn't timed out (false)
 * 3.  Current is idle, and the idle current timer has expired (true)
 * 4.  Only two Vcell_max are < VBAL_MIN  (true)
 * 5.  All Vcell_max are < VBAL_MIN (false)
 * 6.  Vcell_max > VBAL_MIN There is not a max-min voltage spread of at least VBAL_SPREAD on two entries (true)
 * 7.  Vcell_max > VBAL_MIN There is not a max-min voltage spread of at least VBAL_SPREAD on all entries (false)
 * 8.  Vcell_max > VBAL_MIN There is a max-min voltage spread of at least VBAL_SPREAD (false)
 * 9.  If any temperature is out of range false
 * 10. If all temperatures are in range true
 * 11. Charger is connected and no transition has taken place (true)
 * 12. Charger is connected and a transition has taken place (false)
 * 13. Balance session active and a no key switch transition (true)
 * 14. Balance session active and a key switch transition (false)
 * 15. Session time has not expired (true)
 * 16. Session time has expired (false)
 *
 */

//There are seven "tests" each having a true or a false.  This is why there is a 7 x 2 array
//for the test results
uint8_t bms_app_balance_is_okay_to_balance_results[17];
void run_bms_app_balance_is_okay_to_balance_test()
{
    //(0.) Test zero, set up conditions so that every thing is true
    gBatterySummary.pack_current = 0;
    utils_get_elapsed_time_ms_value = TBAL_CURRENT_IDLE_TIME_MSEC+1;

    uint16_t coreId = 0;
    for( ;coreId < MAX_NUM_CORES; ++coreId )
    {
        gCoreDataSlow[ coreId ].max_cell_voltage = VBAL_MIN+0.200f;
        gCoreDataSlow[ coreId ].min_cell_voltage = VBAL_MIN;
        gCoreDataSlow[ coreId ].temperatures[0] = 25.0f;
        gCoreDataSlow[ coreId ].temperatures[1] = 25.0f;
    }

    gBatteryStatus.bits.charger_connected = 0;
    gBatteryStatus.bits.balancing_session = 0;
    sBalanceSessionTimeSeconds = 0;

    //Do Test zero...should return true
    bms_app_balance_is_okay_to_balance_results[0] = bms_app_is_okay_to_balance();

    //(1.) Test one should return false
    gBatterySummary.pack_current = 100.0f;
    //Do test zero...should return zero
    bms_app_balance_is_okay_to_balance_results[1] = !bms_app_is_okay_to_balance();

    //(2.) Test two should return false
    gBatterySummary.pack_current = 0.0f;
    utils_get_elapsed_time_ms_value = TBAL_CURRENT_IDLE_TIME_MSEC-1000;
    bms_app_balance_is_okay_to_balance_results[2] = !bms_app_is_okay_to_balance();

    //(3.)  Test thred should return true
    utils_get_elapsed_time_ms_value = TBAL_CURRENT_IDLE_TIME_MSEC+100;
    bms_app_balance_is_okay_to_balance_results[3] = bms_app_is_okay_to_balance();

    //(4.)  Test four should return true
    gCoreDataSlow[ 2 ].max_cell_voltage = VBAL_MIN-0.001f;
    gCoreDataSlow[ 4 ].max_cell_voltage = VBAL_MIN-0.001f;
    bms_app_balance_is_okay_to_balance_results[4] = bms_app_is_okay_to_balance();

    //(5.)  Test five should return false
    for( coreId = 0; coreId < MAX_NUM_CORES; ++coreId )
    {
        gCoreDataSlow[ coreId ].max_cell_voltage = VBAL_MIN-0.001f;
    }

    bms_app_balance_is_okay_to_balance_results[5] = !bms_app_is_okay_to_balance();

    for( coreId = 0; coreId < MAX_NUM_CORES; ++coreId )
    {
        gCoreDataSlow[ coreId ].max_cell_voltage = VBAL_MIN+0.200f;
    }

    //(6.)  Test six true
    gCoreDataSlow[ 3 ].min_cell_voltage = VBAL_MIN+0.200f;
    gCoreDataSlow[ 5 ].min_cell_voltage = VBAL_MIN+0.200f;
    bms_app_balance_is_okay_to_balance_results[6] = bms_app_is_okay_to_balance();

    //(7.)  Test seven false
    for( coreId = 0; coreId < MAX_NUM_CORES; ++coreId )
    {
        gCoreDataSlow[ coreId ].min_cell_voltage = VBAL_MIN+0.200f;
    }

    bms_app_balance_is_okay_to_balance_results[7] = !bms_app_is_okay_to_balance();

    //(8.) Test eight true
    for( coreId = 0; coreId < MAX_NUM_CORES; ++coreId )
    {
        gCoreDataSlow[ coreId ].min_cell_voltage = VBAL_MIN;
    }
    bms_app_balance_is_okay_to_balance_results[8] = bms_app_is_okay_to_balance();

    //(9.) Test nine false
    gCoreDataSlow[ 1 ].temperatures[0] = TPBAL_MIN-10;
    gCoreDataSlow[ 1 ].temperatures[1] = TPBAL_MIN-10;
    bms_app_balance_is_okay_to_balance_results[9] = !bms_app_is_okay_to_balance();

    //(10.) Test ten true
    gCoreDataSlow[ 1 ].temperatures[0] = 25.0;
    gCoreDataSlow[ 1 ].temperatures[1] = 25.0;
    bms_app_balance_is_okay_to_balance_results[10] = bms_app_is_okay_to_balance();

    //(11.) Test eleven true
    gBatteryStatus.bits.charger_connected = 1;
    gBatteryStatus.bits.charging_mode =  sOldChargingMode = 0;
    bms_app_balance_is_okay_to_balance_results[11] = bms_app_is_okay_to_balance();

    //(12.) Test twelve false
    gBatteryStatus.bits.charger_connected = 1;
    gBatteryStatus.bits.charging_mode = CHARGING_MODE_CHARGING;
    bms_app_balance_is_okay_to_balance_results[12] = !bms_app_is_okay_to_balance();
    sOldChargingMode = gBatteryStatus.bits.charging_mode;
    
    //(13.) Test thirteen (oldcharging mode and current charging mode should be equal at this point) true
    gBatteryStatus.bits.balancing_session = 1;
    gBatteryStatus.bits.key_input_state = BMS_KEY_STATE_OFF;
    bms_app_balance_is_okay_to_balance_results[13] = bms_app_is_okay_to_balance();

    //(14.) Test fourteen false
    gBatteryStatus.bits.balancing_session = 1;
    gBatteryStatus.bits.key_input_state = BMS_KEY_STATE_TRANSITION_TO_OFF;
    bms_app_balance_is_okay_to_balance_results[14] = bms_app_is_okay_to_balance();

    //(15.) Test fifteen true
    gBatteryStatus.bits.key_input_state = BMS_KEY_STATE_OFF;
    sBalanceSessionTimeSeconds = TMAX_BALANCE_SESSION_SECONDS-10;
    bms_app_balance_is_okay_to_balance_results[15] = bms_app_is_okay_to_balance();

    //(16.) Test sixteen false
    gBatteryStatus.bits.key_input_state = BMS_KEY_STATE_OFF;
    sBalanceSessionTimeSeconds = TMAX_BALANCE_SESSION_SECONDS+10;
    bms_app_balance_is_okay_to_balance_results[16] = !bms_app_is_okay_to_balance();
}



